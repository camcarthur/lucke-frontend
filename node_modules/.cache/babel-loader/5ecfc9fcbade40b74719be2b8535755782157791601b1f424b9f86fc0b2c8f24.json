{"ast":null,"code":"var _jsxFileName = \"/Users/colinmcarthur/Projects/software/lucke-frontend/src/context/AuthContext.js\",\n  _s = $RefreshSig$();\nimport React, { createContext, useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport PropTypes from 'prop-types';\nimport API from '../config/api';\nimport { apiFetch } from '../api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const AuthContext = /*#__PURE__*/createContext();\nfunction AuthProvider({\n  children\n}) {\n  _s();\n  const [auth, setAuth] = useState({\n    isLoggedIn: false,\n    role: '',\n    user: null,\n    loading: true\n  });\n\n  // Check session on mount\n  const checkSession = async () => {\n    try {\n      const res = await apiFetch({\n        credentials: 'include'\n      });\n      if (!res.ok) {\n        setAuth({\n          isLoggedIn: false,\n          role: '',\n          user: null,\n          loading: false\n        });\n        return;\n      }\n      const data = await res.json();\n      setAuth({\n        isLoggedIn: true,\n        role: data.user.role,\n        user: data.user,\n        loading: false\n      });\n    } catch (error) {\n      setAuth({\n        isLoggedIn: false,\n        role: '',\n        user: null,\n        loading: false\n      });\n    }\n  };\n  useEffect(() => {\n    checkSession();\n  }, []);\n  const login = async (username, password) => {\n    try {\n      const res = await apiFetch('/login', {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          username,\n          password\n        })\n      });\n      if (!res.ok) {\n        throw new Error('Login failed');\n      }\n      const data = await res.json();\n      setAuth({\n        isLoggedIn: true,\n        role: data.user.role,\n        user: data.user,\n        loading: false\n      });\n      return data;\n    } catch (error) {\n      setAuth({\n        isLoggedIn: false,\n        role: '',\n        user: null,\n        loading: false\n      });\n      throw error;\n    }\n  };\n  const logout = async () => {\n    try {\n      await apiFetch('/logout', {\n        method: 'POST',\n        credentials: 'include'\n      });\n    } catch (error) {\n      console.error('Logout error:', error);\n    }\n    setAuth({\n      isLoggedIn: false,\n      role: '',\n      user: null,\n      loading: false\n    });\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      auth,\n      login,\n      logout\n    },\n    children: !auth.loading && children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 66,\n    columnNumber: 5\n  }, this);\n}\n_s(AuthProvider, \"RUMXUxoRGwUsg9Ohx+P9VRD6Lg8=\");\n_c = AuthProvider;\nAuthProvider.propTypes = {\n  children: PropTypes.node.isRequired\n};\nexport default AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useState","useEffect","useNavigate","PropTypes","API","apiFetch","jsxDEV","_jsxDEV","AuthContext","AuthProvider","children","_s","auth","setAuth","isLoggedIn","role","user","loading","checkSession","res","credentials","ok","data","json","error","login","username","password","method","headers","body","JSON","stringify","Error","logout","console","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","propTypes","node","isRequired","$RefreshReg$"],"sources":["/Users/colinmcarthur/Projects/software/lucke-frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport PropTypes from 'prop-types';\nimport API from '../config/api';\nimport { apiFetch } from '../api';\n\nexport const AuthContext = createContext();\n\nfunction AuthProvider({ children }) {\n  const [auth, setAuth] = useState({ isLoggedIn: false, role: '', user: null, loading: true });\n\n  // Check session on mount\n  const checkSession = async () => {\n    try {\n      const res = await apiFetch( {\n        credentials: 'include'\n      });\n      if (!res.ok) {\n        setAuth({ isLoggedIn: false, role: '', user: null, loading: false });\n        return;\n      }\n      const data = await res.json();\n      setAuth({ isLoggedIn: true, role: data.user.role, user: data.user, loading: false });\n    } catch (error) {\n      setAuth({ isLoggedIn: false, role: '', user: null, loading: false });\n    }\n  };\n\n  useEffect(() => {\n    checkSession();\n  }, []);\n\n  const login = async (username, password) => {\n    try {\n      const res = await apiFetch('/login', {\n        method: 'POST',\n        credentials: 'include',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ username, password })\n      });\n      if (!res.ok) {\n        throw new Error('Login failed');\n      }\n      const data = await res.json();\n      setAuth({ isLoggedIn: true, role: data.user.role, user: data.user, loading: false });\n      return data;\n    } catch (error) {\n      setAuth({ isLoggedIn: false, role: '', user: null, loading: false });\n      throw error;\n    }\n  };\n\n  const logout = async () => {\n    try {\n      await apiFetch('/logout', {\n        method: 'POST',\n        credentials: 'include'\n      });\n    } catch (error) {\n      console.error('Logout error:', error);\n    }\n    setAuth({ isLoggedIn: false, role: '', user: null, loading: false });\n  };\n\n  return (\n    <AuthContext.Provider value={{ auth, login, logout }}>\n      {!auth.loading && children}\n    </AuthContext.Provider>\n  );\n}\n\nAuthProvider.propTypes = {\n  children: PropTypes.node.isRequired,\n};\n\nexport default AuthProvider;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}